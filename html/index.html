<html>
    <body>
        <div id="resetting" style="display:none"><b> The device is resetting now, you can close this window </b></div>
        <div id="form_contents">
        <h1 style="color: #4485b8; text-align: center;">sonoff-danimtb</h1>
        <p style="text-align: center;"><span class="col-11 text-gray-dark mr-2">Alternative firmware for Itead Sonoff (ESP8266/ESP8285 based) devices to use them in Home Assistant</span></p>
        <hr />
        <table>
            <tbody>
                <tr>
                    <td>Firmware version:</td>
                    <td><div id="firmware_version"></div></td>
                </tr>
                <tr>
                    <td>Hardware:</td>
                    <td><div id="hardware"></div></td>
                </tr>
            </tbody>
        </table>
        <hr />
        <form action="http://192.168.4.1/submit" onsubmit="show_resetting()" method="POST">
            <p style="text-align: center;"><strong><span style="text-decoration: underline;">Network Settings</span></strong></p>
            <table style="width: 550px; margin-left: auto; margin-right: auto; height: 182px;">
                <tbody>
                    <tr style="height: 33.5px;">
                        <td style="width: 275px; height: 33.5px; text-align: right;"><strong>WIFI SSID:</strong></td>
                        <td style="width: 275px; text-align: left; height: 33.5px;"><input maxlength="50" name="wifi_ssid" size="30" id="wifi_ssid" /></td>
                    </tr>
                    <tr style="height: 21px;">
                        <td style="width: 275px; height: 21px; text-align: right;"><strong>WIFI Password:</strong></td>
                        <td style="width: 275px; text-align: left; height: 21px;"><input maxlength="50" name="wifi_password" size="30" type="text" id="wifi_password" /></td>
                    </tr>
                    <tr style="height: 21px;">
                        <td style="width: 275px; height: 21px; text-align: right;"><strong>IP:</strong></td>
                        <td style="width: 275px; height: 21px; text-align: left;"><input maxlength="50" name="ip" size="15" type="text" id="ip" /></td>
                    </tr>
                    <tr style="height: 21px;">
                        <td style="width: 275px; height: 21px; text-align: right;"><strong>Gateway:</strong></td>
                        <td style="width: 275px; height: 21px; text-align: left;"><input maxlength="50" name="gateway" size="15" type="text" id="gateway" /></td>
                    </tr>
                    <tr style="height: 21px;">
                        <td style="width: 275px; height: 21px; text-align: right;"><strong>Mask:</strong></td>
                        <td style="width: 275px; height: 21px; text-align: left;"><input maxlength="50" name="mask" size="15" type="text" id="mask" /></td>
                    </tr>
                    <tr style="height: 21px;">
                        <td style="width: 275px; text-align: right;"><strong>OTA Update Server:</strong></td>
                        <td style="width: 275px; text-align: left;"><input maxlength="50" name="ota_server" size="30" type="text" id="ota_server" /></td>
                    </tr>
                </tbody>
            </table>
            <p><strong>&nbsp;</strong></p>
            <p style="text-align: center;"><strong><span style="text-decoration: underline;">MQTT Settings</span></strong></p>
            <table style="width: 550px; margin-left: auto; margin-right: auto;">
                <tbody>
                    <tr>
                        <td style="width: 275px; text-align: right;"><strong>MQTT Server:</strong></td>
                        <td style="width: 275px; text-align: left;"><input maxlength="50" name="mqtt_server" size="30" type="text" id="mqtt_server" /></td>
                    </tr>
                    <tr>
                        <td style="width: 275px; text-align: right;"><strong>MQTT Port:</strong></td>
                        <td style="width: 275px; text-align: left;"><input maxlength="4" name="mqtt_port" size="4" type="text" id="mqtt_port" /></td>
                    </tr>
                    <tr>
                        <td style="width: 275px; text-align: right;"><strong>MQTT Username:</strong></td>
                        <td style="width: 275px; text-align: left;"><input maxlength="50" name="mqtt_username" size="30" type="text" id="mqtt_username" /></td>
                    </tr>
                    <tr>
                        <td style="width: 275px; text-align: right;"><strong>MQTT Password:</strong></td>
                        <td style="width: 275px; text-align: left;"><input maxlength="50" name="mqtt_password" size="30" type="text" id="mqtt_password" /></td>
                    </tr>
                </tbody>
            </table>
            <p style="text-align: center;">&nbsp;</p>
            <p style="text-align: center;"><strong><span style="text-decoration: underline;">Device Data<br /></span></strong></p>
            <table style="width: 550px; margin-left: auto; margin-right: auto;">
                <tbody>
                    <tr>
                        <td style="width: 275px; text-align: right;"><strong>Device Name:</strong></td>
                        <td style="width: 275px; text-align: left;"><input maxlength="50" name="device_name" size="30" type="text" id="device_name" /></td>
                    </tr>
                </tbody>
            </table>
            <table style="width: 550px; margin-left: auto; margin-right: auto;">
                    <tbody>
                        <tr>
                            <td style="width: 550px; text-align: center;">Device name will be used to publish device information over MQTT such as IP, MAC, connection status...</td>
                        </tr>
                    </tbody>
            </table>
            <table style="width: 550px; margin-left: auto; margin-right: auto;">
                <tbody>
                    <tr>
                        <td style="width: 275px; text-align: right;"><strong>MQTT Discovery Prefix:</strong></td>
                        <td style="width: 275px; text-align: left;"><input maxlength="50" name="discovery_prefix" size="30" type="text" id="discovery_prefix" /></td>
                    </tr>
                </tbody>
            </table>
            <table style="width: 550px; margin-left: auto; margin-right: auto;">
                    <tbody>
                        <tr>
                            <td style="width: 550px; text-align: center;">Prefix used for the MQTT discovery topic where the device configuration will be published (Read more: <em><a href="https://www.home-assistant.io/docs/mqtt/discovery/">Home Assistant: MQTT Discovery</a></em>). Leave it empty if you are not using the discovery feature.</td>
                        </tr>
                    </tbody>
            </table>
            <p style="text-align: center;">&nbsp;</p>
            <p style="text-align: center;"><strong><span style="text-decoration: underline;">Component 1<br /></span></strong></p>
            <table style="width: 550px; margin-left: auto; margin-right: auto;">
                <tbody>
                    <tr>
                        <td style="width: 275px; text-align: right;"><strong>Component Name:</strong></td>
                        <td style="width: 275px; text-align: left;"><input maxlength="50" name="component_name1" size="30" type="text" id="component_name1" /></td>
                    </tr>
                </tbody>
            </table>
            <table style="width: 550px; margin-left: auto; margin-right: auto;">
                    <tbody>
                        <tr>
                            <td style="width: 550px; text-align: center;">Name to display in Home Assistant's frontend. It is recommended to use the same value as in Device Name field for devices with only one relay.</td>
                        </tr>
                    </tbody>
            </table>
            <table style="width: 550px; margin-left: auto; margin-right: auto;">
                <tbody>
                    <tr>
                        <td style="width: 275px; text-align: right;"><strong>Component type (light/switch):</strong></td>
                        <td style="width: 275px; text-align: left;"><input maxlength="50" name="component_type1" size="30" type="text" id="component_type1" /></td>
                    </tr>
                </tbody>
            </table>
            <table style="width: 550px; margin-left: auto; margin-right: auto;">
                    <tbody>
                        <tr>
                            <td style="width: 550px; text-align: center;">Home Assistant's MQTT component type to be configured in the discovery. Use "light" or "switch".</td>
                        </tr>
                    </tbody>
            </table>
            <table style="width: 550px; margin-left: auto; margin-right: auto;">
                <tbody>
                    <tr>
                        <td style="width: 275px; text-align: right;"><strong>MQTT Discovery Prefix:</strong></td>
                        <td style="width: 275px; text-align: left;"><input maxlength="50" name="discovery_prefix1" size="30" type="text" id="discovery_prefix1" /></td>
                    </tr>
                </tbody>
            </table>
            <table style="width: 550px; margin-left: auto; margin-right: auto;">
                    <tbody>
                        <tr>
                            <td style="width: 550px; text-align: center;">Prefix used for the MQTT discovery topic where the component configuration will be published (Read more: <em><a href="https://www.home-assistant.io/docs/mqtt/discovery/">Home Assistant: MQTT Discovery</a></em>). Leave it empty if you are not using the discovery feature.</td>
                        </tr>
                    </tbody>
            </table>
            <table style="width: 550px; margin-left: auto; margin-right: auto;">
                <tbody>
                    <tr>
                        <td style="width: 275px; text-align: right;"><strong>MQTT Status Topic:</strong></td>
                        <td style="width: 275px; text-align: left;"><input maxlength="50" name="mqtt_status1" size="30" type="text" id="mqtt_status1" /></td>
                    </tr>
                </tbody>
            </table>
            <table style="width: 550px; margin-left: auto; margin-right: auto;">
                    <tbody>
                        <tr>
                            <td style="width: 550px; text-align: center;">Topic where component status will be published.</td>
                        </tr>
                    </tbody>
            </table>
            <table style="width: 550px; margin-left: auto; margin-right: auto;">
                <tbody>
                    <tr>
                        <td style="width: 275px; text-align: right;"><strong>MQTT Command Topic:</strong></td>
                        <td style="width: 275px; text-align: left;"><input maxlength="50" name="mqtt_command1" size="30" type="text" id="mqtt_command1" /></td>
                    </tr>
                </tbody>
            </table>
            <table style="width: 550px; margin-left: auto; margin-right: auto;">
                    <tbody>
                        <tr>
                            <td style="width: 550px; text-align: center;">Topic where component will subscribe to listen to status changes.</td>
                        </tr>
                    </tbody>
            </table>
            <table style="width: 550px; margin-left: auto; margin-right: auto;">
                </tbody>
                    <tr>
                        <td style="width: 275px; text-align: right;"><strong>MQTT Secondary Command Topic:</strong></td>
                        <td style="width: 275px; text-align: left;"><input maxlength="50" name="mqtt_secondary1" size="30" type="text" id="mqtt_secondary1" /></td>
                    </tr>
            </table>
            <table style="width: 550px; margin-left: auto; margin-right: auto;">
                    <tbody>
                        <tr>
                            <td style="width: 550px; text-align: center;">Topic to publish "TOGGLE" payload whenever a long press in the button is received. Useful to command other MQTT devices directly or to <em><a href="https://www.home-assistant.io/docs/automation/trigger/#mqtt-trigger">trigger automations in Home Assistant</a></em>. Leave it empty if you don't want to use this feature.</td>
                        </tr>
                    </tbody>
            </table>
            <p style="text-align: center;">&nbsp;</p>
            <p style="text-align: center;"><strong><span style="text-decoration: underline;">Component 2<br /></span></strong></p>
            <table style="width: 550px; margin-left: auto; margin-right: auto;">
                    <tbody>
                        <tr>
                            <td style="width: 550px; text-align: center;">Fill this fields ONLY if your device has a second button and relay.</td>
                        </tr>
                    </tbody>
            </table>
            <table style="width: 550px; margin-left: auto; margin-right: auto;">
                <tbody>
                    <tr>
                        <td style="width: 275px; text-align: right;"><strong>Component Name:</strong></td>
                        <td style="width: 275px; text-align: left;"><input maxlength="50" name="component_name2" size="30" type="text" id="component_name2" /></td>
                    </tr>
                    <tr>
                        <td style="width: 275px; text-align: right;"><strong>Component type (light/switch):</strong></td>
                        <td style="width: 275px; text-align: left;"><input maxlength="50" name="component_type2" size="30" type="text" id="component_type2" /></td>
                    </tr>
                    <tr>
                        <td style="width: 275px; text-align: right;"><strong>MQTT Discovery Prefix:</strong></td>
                        <td style="width: 275px; text-align: left;"><input maxlength="50" name="discovery_prefix2" size="30" type="text" id="discovery_prefix2" /></td>
                    </tr>
                    <tr>
                        <td style="width: 275px; text-align: right;"><strong>MQTT Status Topic:</strong></td>
                        <td style="width: 275px; text-align: left;"><input maxlength="50" name="mqtt_status2" size="30" type="text" id="mqtt_status2" /></td>
                    </tr>
                    <tr>
                        <td style="width: 275px; text-align: right;"><strong>MQTT Command Topic:</strong></td>
                        <td style="width: 275px; text-align: left;"><input maxlength="50" name="mqtt_command2" size="30" type="text" id="mqtt_command2" /></td>
                    </tr>
                    <tr>
                        <td style="width: 275px; text-align: right;"><strong>MQTT Secondary Command Topic:</strong></td>
                        <td style="width: 275px; text-align: left;"><input maxlength="50" name="mqtt_secondary2" size="30" type="text" id="mqtt_secondary2" /></td>
                    </tr>
                </tbody>
            </table>
            <p><strong>&nbsp;</strong></p>
            <p style="text-align: center;"><input name="save_button" type="submit" value="Save Settings"/></p>
        </form>
        <hr />
        </div>
        <p style="text-align: center;"><em><a href="https://github.com/danimtb/sonoff-danimtb">github@sonoff-danimtb</a></em></p>
        <script>

            function show_resetting(){
                document.getElementById("form_contents").style.display = "none";
                document.getElementById("resetting").style.display = "block";
                // Validation could go here
                return true;
            }

            function GetAsync(url, callback)
            {
                var xmlHttp = new XMLHttpRequest();
                xmlHttp.onreadystatechange = function() {
                    if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
                        callback(xmlHttp.responseText);
                }
                xmlHttp.open("GET", url, true);
                xmlHttp.send(null);
            }

            window.onload = function() {

                GetAsync("http://192.168.4.1/data", function(response) {

                    var data = JSON.parse(response);

                    document.getElementById("firmware_version").innerHTML = data.firmware_version;
                    document.getElementById("hardware").innerHTML = data.hardware;

                    document.getElementById("wifi_ssid").value = data.wifi_ssid;
                    document.getElementById("wifi_password").value = data.wifi_password;
                    document.getElementById("ip").value = data.ip;
                    document.getElementById("gateway").value = data.gateway;
                    document.getElementById("mask").value = data.mask;
                    document.getElementById("ota_server").value = data.ota_server;

                    document.getElementById("mqtt_server").value = data.mqtt_server;
                    document.getElementById("mqtt_port").value = data.mqtt_port;
                    document.getElementById("mqtt_username").value = data.mqtt_username;
                    document.getElementById("mqtt_password").value = data.mqtt_password;

                    document.getElementById("device_name").value = data.device_name;
                    document.getElementById("discovery_prefix").value = data.discovery_prefix;

                    document.getElementById("component_name1").value = data.component_name1;
                    document.getElementById("component_type1").value = data.component_type1;
                    document.getElementById("discovery_prefix1").value = data.discovery_prefix1;
                    document.getElementById("mqtt_status1").value = data.mqtt_status1;
                    document.getElementById("mqtt_command1").value = data.mqtt_command1;
                    document.getElementById("mqtt_secondary1").value = data.mqtt_secondary1;

                    document.getElementById("component_name2").value = data.component_name2;
                    document.getElementById("component_type2").value = data.component_type2;
                    document.getElementById("discovery_prefix2").value = data.discovery_prefix2;
                    document.getElementById("mqtt_status2").value = data.mqtt_status2;
                    document.getElementById("mqtt_command2").value = data.mqtt_command2;
                    document.getElementById("mqtt_secondary2").value = data.mqtt_secondary2;
                });
            }
        </script>
    </body>
</html>